{% extends "_layouts/base.html" %}
{% set id = 'trusted-partners' %}
{% set title = 'Trusted Ionic Partners - Ionic App Development Partners' %}
{% set bodyController = 'trustedPartnersCtrl' %}
{% set meta_description = "Ionic Trusted Partners are certified consulting agencies that we connect with businesses looking to jumpstart their Ionic app development." %}
{% set cssPath = 'trusted-partners' %}
{% set stickyNav = true %}
{% set recaptcha = true %}

{% import "_includes/macros.html" as macros %}

{% block body_attributes %}
   ng-click="deselect()"
{% endblock %}

{% block main %}
<div class="banner cta">
  <hgroup class="container">
    {% if notification %}
      <h2 class="text-center {{notificationClass}}">
        {{ notification }}
      </h2>
    {% endif %}
    <h1>Supercharge your apps</h1>
    <p>
      Ionic <strong>Trusted Partners</strong> are certified consulting agencies
      that we connect with businesses looking to jumpstart their Ionic app
      development.
    </p>
    <button class="btn rounded white"
            onclick="document.getElementById('partners').scrollIntoView({behavior: 'smooth'});">
            Find a Trusted Partner
    </button>
    <p class="sm">
      Or <a data-toggle="modal" data-target="#applicationForm">apply</a> to
      become one.
    </p>
  </hgroup>
</div>

<div class="perks">
  <div class="container">
    <hgroup class="text-center">
      <h2>
        Built by pros. Vetted by Ionic.
      </h2>
      <p class="lg">
        Boost your Ionic app development and deliver better mobile apps, faster.
      </p>
    </hgroup>
    <div class="list">
      <div class="item pros">
        <h4>Connect with pros</h4>
        <p>
          Let Ionic help you connect with the perfect partner to build your
          mobile apps.
        </p>
      </div>
      <div class="item quality">
        <h4>Ensure quality</h4>
        <p>
          All our Trusted Partners have experience building Ionic apps, approved
          by us.
        </p>
      </div>
      <div class="item platforms">
        <h4>Go cross-platform</h4>
        <p>
          Why manage multiple codebases? Ionic apps are one codebase, for all
          platforms.
        </p>
      </div>
    </div>
  </div>
</div>

<main class="partners" id="partners">
  {# <section class="map" id="partner-map">
    <ul class="dots container">
      {% for tp in trustedPartners %}
        <li style="left:{{tp.coordinates[0]}}%; top:{{tp.coordinates[1]}}%;"
            class="{{tp.slug}}">
          <div class="box
                      {{tp.slug}}
                      {% if tp.coordinates[0] > 55 %} left{% endif %}
                      {% if tp.coordinates[1] > 55 %} bottom{% endif %}">
            <!-- <strong>{{tp.name}}</strong> -->
            <a class="btn ionic sm" ng-click="learnMore('{{tp.slug}}')">
              Learn more
            </a>
        </li>
      {% endfor %}
    </ul>
    <hgroup class="text-center container">
      <h2>
        Connect across the globe.
      </h2>
      <p class="lg">
        Select a Trusted Partner that fits your app develolpment needs.
      </p>
    </hgroup>
  </section> #}
  <section id="platinum" class="container">
    <h2>Platinum Partners</h2>
    <ul class="list" id="tp-list-platinum">
      {% for tp in trustedPartners %}
        {% if tp.level == 'platinum' %}
          {{ macros.trustedPartnerPremium(tp) }}
        {% endif %}
      {% endfor %}
    </ul>
  </section>
  <section id="gold" class="container">
    <h2>Gold Partners</h2>
    <ul class="list" id="tp-list-gold">
      {% for tp in trustedPartners %}
        {% if tp.level == 'gold' %}
          {{ macros.trustedPartnerPremium(tp) }}
        {% endif %}
      {% endfor %}
    </ul>
  </section>
  {# <section id="community" class="container">
    <h2>Community Partners</h2>
    <ul class="list" id="tp-list">
      {% for tp in trustedPartners %}
        {% if tp.level != 'gold' and tp.level != 'platinum' %}
          {{ macros.trustedPartner(tp) }}
        {% endif %}
      {% endfor %}
    </ul>
  </section> #}
</main>
<div class="bar hero text-center">
  <hgroup class="container">
    <h3>Does your business build Ionic apps professionally?</h3>
    <a class="btn white sm" data-toggle="modal" data-target="#applicationForm">
      Apply to be a Trusted Partner
    </a>
  </hgroup>
</div>
{% endblock %}

{% block modals %}
<div id="tp-learn-more"
     class="modal collapse fade"
     tabindex="-1"
     role="dialog">
  <div class="modal-dialog" role="document" ng-class="{'flip':showContact}">
    <div class="modal-content">
      <div class="modal-body front">
        <button type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close">
          <span>&times;</span>
        </button>
        <aside>

        <iframe width="238"
                height="120"
                frameborder="0"
                scrolling="no"
                marginheight="0"
                marginwidth="0"
                src="https://maps.google.com/maps?amp;ie=UTF8&amp;gl=pl&amp;t=m&amp;z=12&amp;iwloc=A&amp;output=embed&q=google+maps+121+s+pinckney+madison+wi">
        </iframe>
          <a class="btn ionic"
             ng-click="connect()"
             ng-bind="'Connect with ' + selectedCompany"></a>
          <address>
          </address>
          <ul class="features">
          </ul>
        </aside>
        <section>
          <div class="logo"></div>
          <ul class="tablist" role="tablist">
            <li role="presentation" class="active">
              <a href="#company-info"
                 aria-controls="company-info"
                 role="tab"
                 data-toggle="tab">Company Info</a>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div role="tabpanel"
                 class="tab-pane active"
                 id="company-info"
                 ng-bind-html="company.info">

            </div>
          </div>
        </section>
      </div>

      <div class="modal-body back">
        <button type="button"
                class="go-back"
                aria-label="go back"
                ng-click="showContact = false">
          <span class="icon ion-android-arrow-back"></span>
        </button>
        <button type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close">
          <span>&times;</span>
        </button>
        <hgroup class="text-center">
          <h3 ng-bind="'Get in touch with ' + selectedCompany"></h3>
          <p class="lg">
            Send us a detailed message and a sales representative will
            get back to you soon.
          </p>
        </hgroup> {#
        <form action="/trusted-partners"
              class="form-inline container"
              method="post"
              name="lead">
          <input class="form-control"
                 type="text"
                 name="first_name"
                 placeholder="Your first name *"
                 required>
          <input class="form-control"
                type="text"
                name="last_name"
                placeholder="Your last name *"
                required>
          <input class="form-control"
                 type="email"
                 name="email"
                 placeholder="Email *"
                 ng-model="email"
                 ng-class="{ 'invalid': contact.email.$error.email }"
                 required>
          <input class="form-control"
                 type="text"
                 name="company"
                 placeholder="Company name *"
                 required>
          <div class="select-wrapper"><select class="form-control select-helper"
                  name="employees"
                  required>
            <option value="null" disabled selected>Employees *</option>
            <option value="1-5">1-5</option>
            <option value="5-20">5-20</option>
            <option value="20-50">20-50</option>
            <option value="50-500">50-500</option>
            <option value="500-10000">500-10000</option>
            <option value="10000+">10000+</option>
          </select><div class="up"></div><div class="dn"></div></div>

          <input class="form-control"
                 type="text"
                 name="title"
                 placeholder="Job title *"
                 required>
          <div class="select-wrapper">
            <select class="form-control select-helper"
                    name="budget"
                    required>
              <option value="null" disabled selected>Budget (optional)</option>
              <option value="25000-50000">$25,000-50,000</option>
              <option value="50000-100000">$50,000-100,000</option>
              <option value="100000-250000">$100,000-250,000</option>
              <option value="250000+">$250,000+</option>
            </select>
            <div class="up"></div>
            <div class="dn"></div>
          </div>
          <input class="form-control"
                 type="tel"
                 name="phone"
                 placeholder="Phone *"
                 required>

          <textarea name="message"
                    cols="30"
                    rows="10"
                    placeholder="Tell us about you company and the app(s) you'd like to build"
                    required
                    ></textarea>

          <input type="hidden" name="form_name" value="need_trusted_partner" />
          <input type="hidden" name="selected-partner" ng-value="selectedCompany" />
          <input type="hidden" name="form" value="lead" />
          <button
            class="btn ionic"
            value="Send message"
            data-sitekey="6LfbcKAUAAAAACUDq_t59TP8MawQXB37DVEeSOjZ"
            data-callback='onSubmit'
            data-action='submit'>
            Send message
          </button>
        </form> #}

      </div>
    </div>
  </div>
</div>

<div class="modal collapse fade"
     id="applicationForm"
     tabindex="-1"
     role="dialog"
     aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close">
          <span>&times;</span>
        </button>
        {# <hgroup class="hero text-center">
          <p class="lg">
            We are currently not accepting new applications for the Trusted
            Partners program. We will reopen the application process when the
            current applications have been processed.
          </p>
          <button class="btn ionic text-center sm"
                  type="button"
                  data-dismiss="modal">
            Close
          </button>
        </hgroup> #}
        <hgroup class="hero text-center">
          <h3>Apply to be a Trusted Partner</h3>
          <p class="lg">
            Let us know about your company, the apps you've built, and why you
            are applying.
          </p>
        </hgroup>
        <form action="/trusted-partners"
              id="trustedPartnersForm"
              class="form-inline container"
              method="post"
              name="application">
          <input class="form-control"
                 type="text"
                 name="first_name"
                 placeholder="Your first name *"
                 required>
          <input class="form-control"
                type="text"
                name="last_name"
                placeholder="Your last name *"
                required>
          <input class="form-control"
                 type="email"
                 name="email"
                 placeholder="Email *"
                 ng-model="email"
                 ng-class="{ 'invalid': contact.email.$error.email }"
                 required>
          <input class="form-control"
                 type="text"
                 name="company"
                 placeholder="Company name *"
                 required>
          <div class="select-wrapper"><select class="form-control select-helper"
                  name="employees"
                  required>
            <option value="null" disabled selected>Employees *</option>
            <option value="1-5">1-5</option>
            <option value="5-20">5-20</option>
            <option value="20-50">20-50</option>
            <option value="50-500">50-500</option>
            <option value="500+">500+</option>
          </select><div class="up"></div><div class="dn"></div></div>
          <input class="form-control"
                 type="tel"
                 name="phone"
                 placeholder="Phone *"
                 required>
          <input class="form-control full-width"
                 type="text"
                 name="title"
                 placeholder="Job title *"
                 required>
          <textarea name="message"
                    cols="30"
                    rows="10"
                    placeholder="Please tell us about your case studies and projects with Ionic."
                    required
                    ></textarea>

          <input type="hidden" name="form_name" value="become_trusted_partner" />
          <input type="hidden" name="form" value="application" />
          <button 
            class="btn ionic g-recaptcha"
            value="Send message"
            id="trustedPartnersSubmit"
            data-sitekey="6LfbcKAUAAAAACUDq_t59TP8MawQXB37DVEeSOjZ"
            data-callback='onSubmit'
            data-action='submit'>
            Send message
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.8/angular.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.8/angular-animate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.8/angular-cookies.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.8/angular-sanitize.min.js"></script>
<script>
  const trustedPartnersForm = document.getElementById("trustedPartnersForm");
  
  function onSubmit() {
   
    if (trustedPartnersForm.reportValidity()) {
      
      grecaptcha.ready(function() {
        grecaptcha.execute('6LfbcKAUAAAAACUDq_t59TP8MawQXB37DVEeSOjZ', {action: 'submit'});
      });
      trustedPartnersForm.submit();
    }
  }
</script>

<script>

var IonicSiteModule = angular.module('IonicSite',
  ['ngAnimate', 'ngSanitize', 'ngCookies']);

IonicSiteModule
.controller('trustedPartnersCtrl', ['$scope', '$sce', '$timeout' ,
function($scope, $sce, $timeout) {
  var mapsURL = 'https://maps.google.com/maps?ie=UTF8&gl=pl&t=m&z=10';
  mapsURL += '&iwloc=A&output=embed&q=';
  // cache static selectors
  var $modal = $('#tp-learn-more');
  var $modalBtn = $modal.find('a.btn.ionic');
  var $companyInfo = $modal.find('#company-info');
  var $features = $modal.find('.features');
  var $address = $modal.find('address');
  var $iframe = $modal.find('iframe');
  var $logo = $modal.find('.logo');
  var activePartnerInMapEl = null;

  $scope.connect = function(e) {
    if ($scope.premium) {
      window.open($scope.link, '_blank');
     } else {
      $scope.showContact = true;
     } 
  }

  $scope.learnMore = function(e) {
    
    let $modalInfo;
    $scope.premium = false;
    if (typeof e === 'string') {
      $modalInfo = $('#tp-list .' + e).find('.modal-info');
    } else if (!e || !e.target.parentElement) {
      return;
    // Go up an extra level for premium partners
    } else if ($(e.target).parent().is('a')) {
      $modalInfo = $(e.target).parent().parent().find('.modal-info');
    } else {
      $modalInfo = $(e.target).parent().find('.modal-info');
    }

    var $newAddress = $modalInfo.find('address');
    $scope.selectedCompany = $modalInfo.data('name');
    $scope.link = $modalInfo.data('link');
    $scope.premium = $modalInfo.parent().is('.premium');

    $logo.removeClass().addClass('logo ' + $modalInfo.data('handle'));
    $companyInfo.html($modalInfo.find('.company-info').html());
    $features.html($modalInfo.find('.features').html());

    const newAddress = $newAddress[0].dataset['mapsaddress'] ? 
      $newAddress[0].dataset['mapsaddress'] : $newAddress.html()
        .replace(/<\/?strong>/g, '')
        //.replace(/<strong>.+<\/strong>/g, '')
        .replace(/<br>/g, ',+');

    $address.html($newAddress.html());
    $iframe.attr('src', mapsURL + newAddress
        .replace(/(\r\n|\n|\r)/gm, ',+')
        .replace(/\s+/g, '+')
        .replace(' ', '+'));

    $scope.showContact = false;

    $timeout(function() {
      $modal.modal();
      $scope.selectedCompany = $modalInfo.data('name');
    });
  };

  $modal.on('hidden.bs.modal', function() {
    $companyInfo.html('');
    $features.html('');
    $address.html('');
    $iframe.attr('src', mapsURL);
    $scope.showContact = false;
  });

  $scope.init = function() {
    if(!window.location.hash) return;
    $scope.learnMore({
      target: document.querySelector(`#partners li.${window.location.hash.substr(1)} a`)
    });
  }
  $timeout($scope.init.bind(this));
}])
</script>
{% endblock %}
